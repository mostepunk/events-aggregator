# Проект: "Агрегатор событий и уведомлений" — Витрина навыков MongoDB

## Цели проекта
- Продемонстрировать глубокое владение MongoDB: моделирование данных, индексация, агрегации, вложенные документы, транзакции, шардинг, TTL, поиск, оптимизация и интеграция с Python/FastAPI.
- Создать продуктивный pet-проект, полезный для портфолио и демонстрации работодателю.

---

## 1. Краткое описание проекта

**"Event & Notification Hub"** — сервис для сбора, хранения, анализа и доставки событий и уведомлений для разных пользователей и приложений.  
Позволяет:
- Хранить события разного типа, с разной структурой (гибкая схема).
- Группировать события, строить агрегаты, сохранять вложенные документы (метаданные, вложенные комментарии).
- Поддерживать real-time (stream) и отложенные уведомления.
- Работать с TTL, хранить историю, строить отчёты, искать по тексту.

---

## 2. Архитектурные особенности, раскрывающие MongoDB
Основной паттерн будет Event Bus. Основной источник входных данных будет брокер сообщений.
REST будет использоваться как дополнительный инструмент, для ручного управления событиями.

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           EXTERNAL SYSTEMS                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │ Web App     │  │ Mobile App  │  │ Payment     │  │ Auth        │             │
│  │ (Frontend)  │  │ (iOS/Android│  │ Gateway     │  │ Service     │             │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │
│         │                │                │                │                    │
│         ▼                ▼                ▼                ▼                    │
│  ┌─────────────────────────────────────────────────────────────┐                │
│  │                 Message Broker                              │                │
│  │        (Redis Pub/Sub / RabbitMQ / Kafka)                   │                │
│  │                                                             │                │
│  │  Topics/Queues:                                             │                │
│  │  • user.registered    • order.created                       │                │
│  │  • user.login         • payment.completed                   │                │
│  │  • user.logout        • error.occurred                      │                │
│  │  • post.liked         • system.health                       │                │
│  └─────────────────────────────────────────────────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    EVENT & NOTIFICATION HUB                                     │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐                                 ┌─────────────────┐        │
│  │  Event Consumer │◄────── Message Broker ─────────►│  REST API       │        │
│  │                 │                                 │                 │        │
│  │  • Processes    │                                 │  POST /events   │        │
│  │    messages     │                                 │  GET  /events   │        │
│  │  • Bulk writes  │                                 │  GET  /stats    │        │
│  │  • Error        │                                 │  GET  /stream   │        │
│  │    handling     │                                 │                 │        │
│  └─────────────────┘                                 └─────────────────┘        │
│           │                                                   │                 │
│           ▼                                                   ▼                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐│
│  │                      BUSINESS LOGIC LAYER                                   ││
│  │                                                                             ││
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         ││
│  │  │Event Service│  │Notification │  │Analytics    │  │Stream       │         ││
│  │  │             │  │Service      │  │Service      │  │Service      │         ││
│  │  │• Validation │  │• Recipients │  │• Aggregation│  │• Change     │         ││
│  │  │• Enrichment │  │• Templates  │  │• Reports    │  │  Streams    │         ││
│  │  │• Routing    │  │• Delivery   │  │• Real-time  │  │• SSE/WebSock│         ││
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         ││
│  └─────────────────────────────────────────────────────────────────────────────┘│
│           │                    │                    │                    │      │
│           ▼                    ▼                    ▼                    ▼      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐│
│  │                         MONGODB CLUSTER                                     ││
│  │                                                                             ││
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         ││
│  │  │   events    │  │notifications│  │    users    │  │    logs     │         ││
│  │  │             │  │             │  │             │  │             │         ││
│  │  │• Flexible   │  │• Embedded   │  │• Profiles   │  │• Delivery   │         ││
│  │  │  schema     │  │  recipients │  │• Preferences│  │  tracking   │         ││
│  │  │• TTL index  │  │• Status     │  │             │  │• TTL        │         ││
│  │  │• Text search│  │  tracking   │  │             │  │             │         ││
│  │  │• Compound   │  │             │  │             │  │             │         ││
│  │  │  indexes    │  │             │  │             │  │             │         ││
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         ││
│  └─────────────────────────────────────────────────────────────────────────────┘│
│                                    │                                            │
└────────────────────────────────────┼────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          DELIVERY CHANNELS                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │   Email     │  │    SMS      │  │  Push       │  │ WebSocket   │             │
│  │  Service    │  │  Gateway    │  │Notifications│  │   Clients   │             │
│  │             │  │             │  │             │  │             │             │
│  │• SMTP       │  │• Twilio     │  │• FCM/APNS   │  │• Real-time  │             │
│  │• Templates  │  │• Bulk send  │  │• Device     │  │  updates    │             │
│  │• Tracking   │  │             │  │  tokens     │  │• Live       │             │
│  │             │  │             │  │             │  │  dashboards │             │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────────────────────┘
```
### 2.1. Гибкая схема (schema-less)
- События разных типов (логин, оплата, коммент, лайк, ошибка и т.д.) хранятся в одной коллекции с разной структурой.
- Использование вложенных документов и массивов (например, список получателей, embedded comments).

### 2.2. Индексация и поиск
- Составные индексы (`user_id` + `type` + `created_at`).
- Текстовый поиск (full-text search по сообщениям).
- Геоиндекс для событий с гео-меткой.

### 2.3. Агрегации и отчёты
- Использование pipeline-агрегаций для построения статистики: число событий по дням, топ-получатели, активные пользователи.
- Группировка по типу событий, по времени, по географии.

### 2.4. TTL и автоматическое удаление
- Включить TTL-индекс для автоудаления устаревших событий/уведомлений.

### 2.5. Транзакции и bulk-операции
- Использовать bulkWrite для массовой рассылки уведомлений.
- Демонстрировать multi-document transactions (например, при "атомарной" отправке уведомления и записи логов).

### 2.6. Шардинг (если есть опыт)
- Показать, как настроить шардинг по user_id или region.

### 2.7. Change Streams (реальное время)
- Использовать change streams для организации real-time оповещений (pub/sub).

---

## 3. Примерная структура коллекций

- `events`: события разной структуры.
- `notifications`: уведомления пользователям, вложенные статусы доставки.
- `users`: данные пользователей (можно хранить как embedded documents).
- `logs`: логи доставки.

---

## 4. Базовые и продвинутые CRUD-операции

- Создание/чтение/обновление/удаление событий.
- Поиск событий по фильтрам, времени, типу, пользователю.
- Агрегации: топы, распределения, динамика.
- Bulk-операции и транзакции.
- TTL для автоудаления.

---

## 5. REST API (или GraphQL)

- POST /events — создать событие (динамическое тело).
- GET /events?type=...&user_id=... — поиск событий.
- GET /events/aggregate — статистика (динамика, топ).
- POST /notifications/send — массовая рассылка.
- GET /notifications/stream — SSE/WebSocket на основе change streams.
- POST /users — создание пользователя (вложенные профили).

---

## 6. UI или Swagger/OpenAPI

- Добавить наглядную документацию (Swagger UI).
- Можно реализовать простой фронтенд (React/Vue) для live-уведомлений.

---

## 7. Инфраструктура

- Docker Compose с MongoDB (с replicaSet для change streams и транзакций).
- В README.md описать запуск, индексацию, тестовые данные.
- Скрипты для инициализации и наполнения коллекций.

---

## 8. Advanced:  
- Импорт/экспорт коллекций через mongoimport/mongoexport.
- Бэкапы, restore, mongodump.
- Пример миграции схемы.
- Unit и integration тесты с использованием Testcontainers (pytest + mongodb).

---

## 9. Документация

- Объяснить все решения: почему выбрана такая структура, как устроены индексы, примеры запросов, агрегаций.
- Скриншоты/примеры аналитики, real-time стриминга и TTL-удаления.

---

## 10. Что должен увидеть работодатель

- Умение проектировать коллекции для document-oriented подхода.
- Знание индексов, агрегаций, bulk-операций, TTL, транзакций, шардинга.
- Навыки интеграции с FastAPI, Docker, написания тестов.
- Документирование и объяснение технических решений.
